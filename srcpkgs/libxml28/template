# Template file for 'libxml28'
#
# Please keep this in sync with "srcpkgs/libxml2-python"
#
pkgname=libxml28
version=2.8.0
revision=6
wrksrc=libxml2-${version}
build_style=gnu-configure
configure_args="--with-threads --with-history --without-python"
hostmakedepends="automake libtool gettext-devel pkg-config icu50-devel"
makedepends="gcc4 zlib-devel ncurses-devel readline-devel liblzma-devel icu50-devel"
short_desc="Library providing XML and HTML support"
maintainer="Enno Boland <gottox@voidlinux.org>"
license="MIT"
homepage="http://www.xmlsoft.org/"
distfiles="http://xmlsoft.org/sources/libxml2-${version}.tar.gz"
checksum=f2e2d0e322685193d1affec83b21dc05d599e17a7306d7b90de95bb5b9ac622a
nopie_files="/usr/bin/xmllint /usr/bin/xmlcatalog"

pre_configure() {
	CXX=g++-4
	CC=gcc-4
	
	# remove option not supported by clang
	-no-pie
	CFLAGS=${CFLAGS/-fstack-clash-protection/}
	CXXFLAGS=${CXXFLAGS/-fstack-clash-protection/}
	
	autoreconf -fi
	sed '/PROGRAMS =/s,$(noinst_PROGRAMS),,' -i Makefile.in
}

post_install() {
	vlicense COPYING
}

libxml28-devel_package() {
	depends="zlib-devel liblzma-devel icu50-devel libxml28>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/bin/xml2-config
		vmove usr/lib/xml2Conf.sh
		vmove usr/lib/pkgconfig
		vmove usr/share/aclocal
		vmove usr/share/gtk-doc
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
	}
}
